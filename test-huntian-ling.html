<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··å¤©ç»«æŠ€èƒ½æµ‹è¯• - å“ªå’2048</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .test-controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            text-align: center;
        }
        
        .test-btn {
            margin: 5px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-info {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 0, 0.1);
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .instruction-box {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 206, 209, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(0, 206, 209, 0.3);
        }
        
        .instruction-box h4 {
            margin: 0 0 10px 0;
            color: #DC143C;
        }
        
        .key-combo {
            display: inline-block;
            background: #333;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: monospace;
            margin: 0 2px;
        }
        
        .pattern-examples {
            margin: 15px 0;
            padding: 15px;
            background: rgba(64, 224, 208, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(64, 224, 208, 0.3);
        }
        
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            max-width: 200px;
            margin: 10px auto;
            background: #ccc;
            padding: 2px;
            border-radius: 4px;
        }
        
        .pattern-cell {
            aspect-ratio: 1;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .pattern-cell.highlight {
            background: #00CED1;
            color: white;
        }
    </style>
</head>
<body data-theme="nezha">
    <div id="game-container">
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-controls">
            <h3>æ··å¤©ç»«æŠ€èƒ½æµ‹è¯•</h3>
            <div class="test-info">
                <p>æµ‹è¯•ç‰¹å®šæ•°å­—ç»„åˆæ£€æµ‹ã€è¿é”æ¶ˆé™¤ç®—æ³•å’ŒåŠ¨ç”»æ•ˆæœ</p>
            </div>
            
            <div class="instruction-box">
                <h4>ğŸŒŠ æ··å¤©ç»«æŠ€èƒ½ä½¿ç”¨è¯´æ˜ï¼š</h4>
                <p>1. æ£€æµ‹ç‰¹å®šæ•°å­—ç»„åˆæ¨¡å¼è‡ªåŠ¨è§¦å‘æ··å¤©ç»«æŠ€èƒ½</p>
                <p>2. æˆ–è€…ç‚¹å‡»"æ¿€æ´»æ··å¤©ç»«"æŒ‰é’®æ‰‹åŠ¨è§¦å‘</p>
                <p>3. æ”¯æŒé€’å¢åºåˆ—ã€èšé›†æ¨¡å¼ã€å¯¹ç§°æ¨¡å¼ç­‰</p>
                <p>4. è¿é”æ¶ˆé™¤è·å¾—å€æ•°åˆ†æ•°å¥–åŠ±</p>
                <p>5. æŠ€èƒ½å†·å´25ç§’</p>
            </div>
            
            <div class="pattern-examples">
                <h4>ğŸ¯ æ”¯æŒçš„æ¨¡å¼ç¤ºä¾‹ï¼š</h4>
                
                <div style="margin: 10px 0;">
                    <strong>é€’å¢åºåˆ—æ¨¡å¼ (2-4-8):</strong>
                    <div class="pattern-grid">
                        <div class="pattern-cell highlight">2</div>
                        <div class="pattern-cell highlight">4</div>
                        <div class="pattern-cell highlight">8</div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                    </div>
                </div>
                
                <div style="margin: 10px 0;">
                    <strong>èšé›†æ¨¡å¼ (4ä¸ªç›¸åŒæ•°å€¼):</strong>
                    <div class="pattern-grid">
                        <div class="pattern-cell highlight">16</div>
                        <div class="pattern-cell highlight">16</div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell highlight">16</div>
                        <div class="pattern-cell highlight">16</div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                        <div class="pattern-cell"></div>
                    </div>
                </div>
            </div>
            
            <button class="test-btn" onclick="activateHuntianLing()">æ¿€æ´»æ··å¤©ç»«</button>
            <button class="test-btn" onclick="createProgressionPattern()">åˆ›å»ºé€’å¢åºåˆ—</button>
            <button class="test-btn" onclick="createClusterPattern()">åˆ›å»ºèšé›†æ¨¡å¼</button>
            <button class="test-btn" onclick="createSymmetryPattern()">åˆ›å»ºå¯¹ç§°æ¨¡å¼</button>
            <button class="test-btn" onclick="testPatternDetection()">æµ‹è¯•æ¨¡å¼æ£€æµ‹</button>
            <button class="test-btn" onclick="showSkillStatus()">æ˜¾ç¤ºæŠ€èƒ½çŠ¶æ€</button>
            <button class="test-btn" onclick="clearTestResults()">æ¸…é™¤æµ‹è¯•ç»“æœ</button>
            <div id="test-results" style="margin-top: 10px; font-size: 0.9rem;"></div>
        </div>

        <!-- æ¸¸æˆæ ‡é¢˜å’ŒUI -->
        <header class="game-header">
            <h1 class="game-title">å“ªå’2048</h1>
            <div class="score-container">
                <div class="score-box">
                    <div class="score-label">åˆ†æ•°</div>
                    <div id="current-score" class="score-value">0</div>
                </div>
                <div class="score-box">
                    <div class="score-label">æœ€é«˜åˆ†</div>
                    <div id="high-score" class="score-value">0</div>
                </div>
            </div>
        </header>

        <!-- æŠ€èƒ½æ  -->
        <div class="skills-container">
            <div class="skill-item locked" id="skill-three-heads" title="ä¸‰å¤´å…­è‡‚">
                <div class="skill-icon">ğŸ”¥</div>
                <div class="skill-cooldown"></div>
            </div>
            <div class="skill-item locked" id="skill-qiankun-circle" title="ä¹¾å¤åœˆ">
                <div class="skill-icon">â­•</div>
                <div class="skill-cooldown"></div>
            </div>
            <div class="skill-item" id="skill-huntian-ling" title="æ··å¤©ç»« - è¿é”æ¶ˆé™¤">
                <div class="skill-icon">ğŸŒŠ</div>
                <div class="skill-cooldown"></div>
            </div>
            <div class="skill-item locked" id="skill-transformation" title="å“ªå’å˜èº«">
                <div class="skill-icon">âš¡</div>
                <div class="skill-cooldown"></div>
            </div>
        </div>

        <!-- æ¸¸æˆä¿¡æ¯æ˜¾ç¤º -->
        <div class="game-info">
            <div class="info-item">
                <span class="info-label">ç§»åŠ¨:</span>
                <span id="moves-count" class="info-value">0</span>
            </div>
            <div class="info-item">
                <span class="info-label">æ—¶é—´:</span>
                <span id="play-time" class="info-value">0:00</span>
            </div>
            <div class="info-item">
                <span class="info-label">ç­‰çº§:</span>
                <span id="nezha-level" class="info-value">1</span>
            </div>
        </div>

        <!-- æ¸¸æˆä¸»åŒºåŸŸ -->
        <div class="game-area">
            <canvas id="game-canvas" width="400" height="400"></canvas>
            <div id="game-grid" class="game-grid breathing">
                <!-- 4x4ç½‘æ ¼å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <!-- ç‰¹æ•ˆå®¹å™¨ -->
            <div id="effects-container" class="effects-container"></div>
        </div>

        <!-- æ¸¸æˆæ§åˆ¶æŒ‰é’® -->
        <div class="game-controls">
            <button id="new-game-btn" class="control-btn primary">æ–°æ¸¸æˆ</button>
            <button id="pause-btn" class="control-btn">æš‚åœ</button>
            <button id="settings-btn" class="control-btn">è®¾ç½®</button>
        </div>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="game-over-modal" class="modal hidden">
        <div class="modal-content">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p>æœ€ç»ˆåˆ†æ•°: <span id="final-score">0</span></p>
            <p id="new-record" class="hidden">ğŸ‰ æ–°çºªå½•ï¼</p>
            <div class="modal-buttons">
                <button id="restart-btn" class="control-btn primary">é‡æ–°å¼€å§‹</button>
                <button id="close-modal-btn" class="control-btn">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <h2>æ¸¸æˆè®¾ç½®</h2>
            <div class="setting-item">
                <label for="volume-slider">éŸ³é‡</label>
                <input type="range" id="volume-slider" min="0" max="100" value="70">
            </div>
            <div class="setting-item">
                <label for="theme-select">ä¸»é¢˜</label>
                <select id="theme-select">
                    <option value="nezha">å“ªå’ä¸»é¢˜</option>
                    <option value="classic">ç»å…¸ä¸»é¢˜</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="save-settings-btn" class="control-btn primary">ä¿å­˜</button>
                <button id="cancel-settings-btn" class="control-btn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="js/core/Tile.js"></script>
    <script src="js/core/GameState.js"></script>
    <script src="js/core/ThemeConfig.js"></script>
    <script src="js/managers/GridManager.js"></script>
    <script src="js/managers/InputManager.js"></script>
    <script src="js/managers/ThemeManager.js"></script>
    <script src="js/managers/AnimationSystem.js"></script>
    <script src="js/managers/AudioManager.js"></script>
    <script src="js/managers/StateManager.js"></script>
    <script src="js/systems/NezhaSkillSystem.js"></script>
    <script src="js/core/GameEngine.js"></script>
    <script src="js/main.js"></script>

    <script>
        // æµ‹è¯•å‡½æ•°
        function logTest(message) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }

        function activateHuntianLing() {
            if (!game || !game.getNezhaSkillSystem) {
                logTest('âŒ æŠ€èƒ½ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            logTest('ğŸŒŠ å°è¯•æ¿€æ´»æ··å¤©ç»«æŠ€èƒ½...');
            
            const skillSystem = game.getNezhaSkillSystem();
            
            // ç¡®ä¿æŠ€èƒ½å·²è§£é”
            const gameState = game.getGameState();
            gameState.score = 6000; // è®¾ç½®è¶³å¤Ÿçš„åˆ†æ•°è§£é”æŠ€èƒ½
            updateScoreDisplay();
            
            // å¼ºåˆ¶è§£é”æŠ€èƒ½
            skillSystem.unlockSkill('huntianLing');
            
            // æ¿€æ´»æŠ€èƒ½
            const success = skillSystem.triggerSkill('huntianLing');
            
            if (success) {
                logTest('âœ… æ··å¤©ç»«æŠ€èƒ½æ¿€æ´»æˆåŠŸï¼');
                logTest('ğŸ’¡ è§‚å¯Ÿè¿é”æ¶ˆé™¤çš„é¢„è§ˆå’ŒåŠ¨ç”»æ•ˆæœ');
            } else {
                logTest('âŒ æ··å¤©ç»«æŠ€èƒ½æ¿€æ´»å¤±è´¥');
            }
        }

        function createProgressionPattern() {
            if (!game) {
                logTest('âŒ æ¸¸æˆå¼•æ“æœªåˆå§‹åŒ–');
                return;
            }

            logTest('ğŸ§ª åˆ›å»ºé€’å¢åºåˆ—æ¨¡å¼...');
            
            const gameState = game.getGameState();
            
            // æ¸…ç©ºç½‘æ ¼
            for (let x = 0; x < 4; x++) {
                for (let y = 0; y < 4; y++) {
                    gameState.setTile(x, y, null);
                }
            }
            
            // åˆ›å»ºæ°´å¹³é€’å¢åºåˆ— 2-4-8
            gameState.setTile(0, 1, new Tile(0, 1, 2));
            gameState.setTile(1, 1, new Tile(1, 1, 4));
            gameState.setTile(2, 1, new Tile(2, 1, 8));
            
            // åˆ›å»ºå‚ç›´é€’å¢åºåˆ— 4-8-16
            gameState.setTile(3, 0, new Tile(3, 0, 4));
            gameState.setTile(3, 1, new Tile(3, 1, 8));
            gameState.setTile(3, 2, new Tile(3, 2, 16));
            
            // æ·»åŠ ä¸€äº›å…¶ä»–æ–¹å—
            gameState.setTile(0, 0, new Tile(0, 0, 32));
            gameState.setTile(2, 3, new Tile(2, 3, 64));
            
            logTest('âœ… é€’å¢åºåˆ—æ¨¡å¼å·²åˆ›å»º (2-4-8 å’Œ 4-8-16)');
        }

        function createClusterPattern() {
            if (!game) {
                logTest('âŒ æ¸¸æˆå¼•æ“æœªåˆå§‹åŒ–');
                return;
            }

            logTest('ğŸ§ª åˆ›å»ºèšé›†æ¨¡å¼...');
            
            const gameState = game.getGameState();
            
            // æ¸…ç©ºç½‘æ ¼
            for (let x = 0; x < 4; x++) {
                for (let y = 0; y < 4; y++) {
                    gameState.setTile(x, y, null);
                }
            }
            
            // åˆ›å»º16çš„èšé›†æ¨¡å¼
            gameState.setTile(1, 1, new Tile(1, 1, 16));
            gameState.setTile(2, 1, new Tile(2, 1, 16));
            gameState.setTile(1, 2, new Tile(1, 2, 16));
            gameState.setTile(2, 2, new Tile(2, 2, 16));
            
            // åˆ›å»º32çš„èšé›†æ¨¡å¼
            gameState.setTile(0, 0, new Tile(0, 0, 32));
            gameState.setTile(1, 0, new Tile(1, 0, 32));
            gameState.setTile(0, 1, new Tile(0, 1, 32));
            gameState.setTile(0, 2, new Tile(0, 2, 32));
            gameState.setTile(0, 3, new Tile(0, 3, 32));
            
            logTest('âœ… èšé›†æ¨¡å¼å·²åˆ›å»º (16çš„4èšé›† å’Œ 32çš„5èšé›†)');
        }

        function createSymmetryPattern() {
            if (!game) {
                logTest('âŒ æ¸¸æˆå¼•æ“æœªåˆå§‹åŒ–');
                return;
            }

            logTest('ğŸ§ª åˆ›å»ºå¯¹ç§°æ¨¡å¼...');
            
            const gameState = game.getGameState();
            
            // æ¸…ç©ºç½‘æ ¼
            for (let x = 0; x < 4; x++) {
                for (let y = 0; y < 4; y++) {
                    gameState.setTile(x, y, null);
                }
            }
            
            // åˆ›å»ºä¸­å¿ƒå¯¹ç§°æ¨¡å¼
            gameState.setTile(0, 0, new Tile(0, 0, 8));
            gameState.setTile(3, 3, new Tile(3, 3, 8));
            gameState.setTile(1, 0, new Tile(1, 0, 16));
            gameState.setTile(2, 3, new Tile(2, 3, 16));
            gameState.setTile(0, 1, new Tile(0, 1, 32));
            gameState.setTile(3, 2, new Tile(3, 2, 32));
            
            logTest('âœ… å¯¹ç§°æ¨¡å¼å·²åˆ›å»º (ä¸­å¿ƒå¯¹ç§°)');
        }

        function testPatternDetection() {
            if (!game || !game.getNezhaSkillSystem) {
                logTest('âŒ æŠ€èƒ½ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            logTest('ğŸ§ª æµ‹è¯•æ¨¡å¼æ£€æµ‹ç®—æ³•...');
            
            const skillSystem = game.getNezhaSkillSystem();
            
            // æµ‹è¯•ç‰¹å®šæ¨¡å¼æ£€æµ‹
            const patterns = skillSystem.findSpecificPatterns();
            
            logTest(`ğŸ” æ£€æµ‹åˆ° ${patterns.length} ä¸ªæ¨¡å¼:`);
            
            patterns.forEach((pattern, index) => {
                logTest(`   æ¨¡å¼ ${index + 1}: ${pattern.type}, ${pattern.tiles.length} ä¸ªæ–¹å—, å€æ•° x${pattern.multiplier}`);
            });
            
            if (patterns.length === 0) {
                logTest('ğŸ’¡ æ²¡æœ‰æ£€æµ‹åˆ°å¯è¿é”çš„æ¨¡å¼ï¼Œå°è¯•åˆ›å»ºä¸€äº›æµ‹è¯•æ¨¡å¼');
            } else {
                logTest('âœ… æ¨¡å¼æ£€æµ‹å®Œæˆï¼Œå¯ä»¥æ¿€æ´»æ··å¤©ç»«æŠ€èƒ½');
            }
        }

        function showSkillStatus() {
            if (!game || !game.getNezhaSkillSystem) {
                logTest('âŒ æŠ€èƒ½ç³»ç»Ÿæœªåˆå§‹åŒ–');
                return;
            }

            const skillSystem = game.getNezhaSkillSystem();
            const skillInfo = skillSystem.getSkillInfo('huntianLing');
            
            if (skillInfo) {
                const skill = skillInfo.skill;
                const state = skillInfo.state;
                
                logTest('ğŸ“Š æ··å¤©ç»«æŠ€èƒ½çŠ¶æ€:');
                logTest(`   è§£é”: ${skillInfo.unlocked ? 'âœ…' : 'âŒ'}`);
                logTest(`   å¯ç”¨: ${skillInfo.canActivate ? 'âœ…' : 'âŒ'}`);
                logTest(`   æ¿€æ´»ä¸­: ${state.isActive ? 'âœ…' : 'âŒ'}`);
                logTest(`   å†·å´å‰©ä½™: ${Math.ceil(state.cooldownRemaining / 1000)}ç§’`);
                logTest(`   ä½¿ç”¨æ¬¡æ•°: ${state.usageCount}`);
                
                // æ£€æŸ¥å½“å‰æ¨¡å¼
                const patterns = skillSystem.findSpecificPatterns();
                logTest(`   å½“å‰å¯æ£€æµ‹æ¨¡å¼: ${patterns.length} ä¸ª`);
            }
        }

        function clearTestResults() {
            document.getElementById('test-results').innerHTML = '';
            logTest('ğŸ§¹ æµ‹è¯•ç»“æœå·²æ¸…é™¤');
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ æµ‹è¯•ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                logTest('ğŸ“‹ æ··å¤©ç»«æŠ€èƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
                logTest('ğŸ’¡ ç‚¹å‡»"åˆ›å»ºé€’å¢åºåˆ—"ç­‰æŒ‰é’®åˆ›å»ºæµ‹è¯•æ¨¡å¼');
                logTest('ğŸ® ç„¶åç‚¹å‡»"æ¿€æ´»æ··å¤©ç»«"æµ‹è¯•è¿é”æ¶ˆé™¤æ•ˆæœ');
                
                // è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ¨¡å¼
                setTimeout(() => {
                    createProgressionPattern();
                }, 1000);
            }, 1000);
        });
    </script>
</body>
</html>