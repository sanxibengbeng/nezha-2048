<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€èƒ½ç³»ç»Ÿè°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #faf8ef;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .skill-panel {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .skill-button {
            display: inline-block;
            margin: 10px;
            padding: 15px 20px;
            background-color: #8f7a66;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            min-width: 150px;
        }
        .skill-button:hover {
            background-color: #9f8a76;
        }
        .skill-button.locked {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .skill-button.available {
            background-color: #4CAF50;
        }
        .skill-button.cooldown {
            background-color: #ff9800;
        }
        .debug-info {
            background-color: #f0f0f0;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .controls button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #2196F3;
            color: white;
            cursor: pointer;
        }
        .score-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #8f7a66;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æŠ€èƒ½ç³»ç»Ÿè°ƒè¯•</h1>
        
        <div class="score-display">
            å½“å‰åˆ†æ•°: <span id="current-score">0</span>
        </div>
        
        <div class="controls">
            <button onclick="addScore(500)">+500 åˆ†</button>
            <button onclick="addScore(1000)">+1000 åˆ†</button>
            <button onclick="addScore(5000)">+5000 åˆ†</button>
            <button onclick="resetScore()">é‡ç½®åˆ†æ•°</button>
            <button onclick="debugAllSkills()">è°ƒè¯•æ‰€æœ‰æŠ€èƒ½</button>
            <button onclick="clearDebug()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="skill-panel">
            <h2>å“ªå’æŠ€èƒ½</h2>
            <button class="skill-button" id="skill-threeHeadsSixArms" onclick="testSkill('threeHeadsSixArms')">
                ğŸ”¥ ä¸‰å¤´å…­è‡‚
            </button>
            <button class="skill-button" id="skill-qiankunCircle" onclick="testSkill('qiankunCircle')">
                â­• ä¹¾å¤åœˆ
            </button>
            <button class="skill-button" id="skill-huntianLing" onclick="testSkill('huntianLing')">
                ğŸŒŠ æ··å¤©ç»«
            </button>
            <button class="skill-button" id="skill-transformation" onclick="testSkill('transformation')">
                âš¡ å“ªå’å˜èº«
            </button>
        </div>
        
        <div class="debug-info" id="debug-info">
            è°ƒè¯•ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...<br>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„ç±»å’Œç³»ç»Ÿ -->
    <script src="js/core/Tile.js"></script>
    <script src="js/core/GameState.js"></script>
    <script src="js/managers/GridManager.js"></script>
    <script src="js/managers/AnimationSystem.js"></script>
    <script src="js/core/GameEngine.js"></script>
    <script src="js/systems/NezhaSkillSystem.js"></script>

    <script>
        let gameEngine;
        let skillSystem;
        let debugInfo = document.getElementById('debug-info');

        function log(message) {
            console.log(message);
            debugInfo.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }

        function clearDebug() {
            debugInfo.innerHTML = 'è°ƒè¯•ä¿¡æ¯å·²æ¸…é™¤...<br>';
        }

        // åˆå§‹åŒ–æ¸¸æˆå¼•æ“å’ŒæŠ€èƒ½ç³»ç»Ÿ
        function initSystem() {
            try {
                gameEngine = new GameEngine();
                skillSystem = gameEngine.getNezhaSkillSystem();
                
                if (!skillSystem) {
                    log('é”™è¯¯: æ— æ³•è·å–æŠ€èƒ½ç³»ç»Ÿ');
                    return;
                }
                
                // ç›‘å¬æŠ€èƒ½äº‹ä»¶
                skillSystem.on('skillUnlocked', (data) => {
                    log(`æŠ€èƒ½è§£é”: ${data.skill.name}`);
                    updateSkillButtons();
                });
                
                skillSystem.on('skillActivated', (data) => {
                    log(`æŠ€èƒ½æ¿€æ´»: ${data.skill.name}`);
                    updateSkillButtons();
                });
                
                skillSystem.on('skillDeactivated', (data) => {
                    log(`æŠ€èƒ½ç»“æŸ: ${data.skill.name}`);
                    updateSkillButtons();
                });
                
                log('ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');
                updateSkillButtons();
                updateScore();
            } catch (error) {
                log('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                console.error('åˆå§‹åŒ–é”™è¯¯è¯¦æƒ…:', error);
            }
        }

        // æµ‹è¯•æŠ€èƒ½æ¿€æ´»
        function testSkill(skillId) {
            try {
                log(`å°è¯•æ¿€æ´»æŠ€èƒ½: ${skillId}`);
                const success = skillSystem.triggerSkill(skillId);
                log(`æŠ€èƒ½æ¿€æ´»ç»“æœ: ${success ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
            } catch (error) {
                log('æŠ€èƒ½æ¿€æ´»é”™è¯¯: ' + error.message);
                console.error('æŠ€èƒ½æ¿€æ´»é”™è¯¯è¯¦æƒ…:', error);
            }
        }

        // æ·»åŠ åˆ†æ•°
        function addScore(points) {
            try {
                gameEngine.gameState.addScore(points);
                log(`æ·»åŠ  ${points} åˆ†`);
                updateScore();
                updateSkillButtons();
            } catch (error) {
                log('æ·»åŠ åˆ†æ•°å¤±è´¥: ' + error.message);
            }
        }

        // é‡ç½®åˆ†æ•°
        function resetScore() {
            try {
                gameEngine.gameState.score = 0;
                log('åˆ†æ•°å·²é‡ç½®');
                updateScore();
                updateSkillButtons();
            } catch (error) {
                log('é‡ç½®åˆ†æ•°å¤±è´¥: ' + error.message);
            }
        }

        // è°ƒè¯•æ‰€æœ‰æŠ€èƒ½
        function debugAllSkills() {
            const skills = ['threeHeadsSixArms', 'qiankunCircle', 'huntianLing', 'transformation'];
            skills.forEach(skillId => {
                skillSystem.debugSkillState(skillId);
            });
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            const scoreElement = document.getElementById('current-score');
            const currentScore = gameEngine.gameState.getScore();
            scoreElement.textContent = currentScore;
        }

        // æ›´æ–°æŠ€èƒ½æŒ‰é’®çŠ¶æ€
        function updateSkillButtons() {
            const skills = ['threeHeadsSixArms', 'qiankunCircle', 'huntianLing', 'transformation'];
            
            skills.forEach(skillId => {
                const button = document.getElementById(`skill-${skillId}`);
                if (!button) return;
                
                const skillInfo = skillSystem.getSkillInfo(skillId);
                
                // é‡ç½®æ‰€æœ‰çŠ¶æ€ç±»
                button.classList.remove('locked', 'available', 'cooldown');
                
                if (!skillInfo.unlocked) {
                    button.classList.add('locked');
                    button.title = `éœ€è¦ ${skillSystem.skills[skillId].unlockScore} åˆ†è§£é”`;
                } else if (skillInfo.state.isActive) {
                    button.classList.add('available');
                    button.title = 'æŠ€èƒ½æ¿€æ´»ä¸­';
                } else if (skillSystem.skillCooldowns[skillId] > 0) {
                    button.classList.add('cooldown');
                    button.title = `å†·å´ä¸­ (${Math.ceil(skillSystem.skillCooldowns[skillId] / 1000)} ç§’)`;
                } else if (skillInfo.canActivate) {
                    button.classList.add('available');
                    button.title = 'å¯ä»¥æ¿€æ´»';
                } else {
                    button.title = 'ä¸å¯ç”¨';
                }
            });
        }

        // å®šæœŸæ›´æ–°
        function startUpdateLoop() {
            setInterval(() => {
                if (skillSystem) {
                    skillSystem.update(100); // 100ms æ›´æ–°é—´éš”
                    updateSkillButtons();
                }
            }, 100);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            initSystem();
            startUpdateLoop();
        });
    </script>
</body>
</html>
