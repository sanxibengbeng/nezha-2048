<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“ªå’ä¸»é¢˜éŸ³æ•ˆæµ‹è¯• - å“ªå’2048</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .test-controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            text-align: center;
        }
        
        .test-btn {
            margin: 5px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .test-section h4 {
            margin: 0 0 15px 0;
            color: #DC143C;
            text-align: center;
        }
        
        .combo-test {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .score-test {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 165, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }
        
        .tile-test {
            margin: 15px 0;
            padding: 15px;
            background: rgba(138, 43, 226, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }
        
        .sequence-test {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 20, 147, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 20, 147, 0.3);
        }
        
        .test-info {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 0, 0.1);
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .instruction-box {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .instruction-box h4 {
            margin: 0 0 10px 0;
            color: #DC143C;
        }
        
        .volume-control {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .volume-control label {
            min-width: 80px;
            font-weight: 600;
        }
        
        .volume-control input[type="range"] {
            flex: 1;
            max-width: 200px;
        }
        
        .volume-value {
            min-width: 40px;
            font-weight: 600;
            color: #007bff;
        }
        
        .audio-status {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 255, 0.3);
            text-align: left;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.active {
            background: #28a745;
        }
        
        .status-indicator.inactive {
            background: #dc3545;
        }
    </style>
</head>
<body data-theme="nezha">
    <div id="game-container">
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-controls">
            <h3>å“ªå’ä¸»é¢˜éŸ³æ•ˆæµ‹è¯•</h3>
            <div class="test-info">
                <p>æµ‹è¯•æ‰€æœ‰å“ªå’ä¸»é¢˜éŸ³æ•ˆå’Œæ¸¸æˆäº‹ä»¶éŸ³é¢‘åŒæ­¥</p>
                <p><strong>æ³¨æ„ï¼š</strong> éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾éŸ³é¢‘</p>
            </div>
            
            <div class="instruction-box">
                <h4>ğŸµ å“ªå’ä¸»é¢˜éŸ³æ•ˆæµ‹è¯•è¯´æ˜ï¼š</h4>
                <p>1. ç‚¹å‡»"åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ"å¼€å§‹æµ‹è¯•</p>
                <p>2. æµ‹è¯•åŸºç¡€æ¸¸æˆéŸ³æ•ˆï¼ˆç§»åŠ¨ã€åˆå¹¶ã€æ–°æ–¹å—ç­‰ï¼‰</p>
                <p>3. æµ‹è¯•å“ªå’æŠ€èƒ½éŸ³æ•ˆï¼ˆä¸‰å¤´å…­è‡‚ã€ä¹¾å¤åœˆã€æ··å¤©ç»«ã€å˜èº«ï¼‰</p>
                <p>4. æµ‹è¯•æ™ºèƒ½éŸ³æ•ˆï¼ˆè¿å‡»ã€åˆ†æ•°ã€æ–¹å—å‡çº§ç­‰ï¼‰</p>
                <p>5. æµ‹è¯•éŸ³æ•ˆåºåˆ—å’Œç»„åˆæ•ˆæœ</p>
            </div>
            
            <!-- åˆå§‹åŒ–æ§åˆ¶ -->
            <div class="test-section">
                <h4>ğŸ›ï¸ ç³»ç»Ÿæ§åˆ¶</h4>
                <button class="test-btn" onclick="initializeAudioSystem()">åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ</button>
                <button class="test-btn" onclick="destroyAudioSystem()">é”€æ¯éŸ³é¢‘ç³»ç»Ÿ</button>
                <button class="test-btn" onclick="showAudioStatus()">æ˜¾ç¤ºéŸ³é¢‘çŠ¶æ€</button>
                <button class="test-btn" onclick="clearTestResults()">æ¸…é™¤æµ‹è¯•ç»“æœ</button>
            </div>
            
            <!-- åŸºç¡€æ¸¸æˆéŸ³æ•ˆæµ‹è¯• -->
            <div class="test-section">
                <h4>ğŸ® åŸºç¡€æ¸¸æˆéŸ³æ•ˆ</h4>
                <button class="test-btn" onclick="testGameSound('move')">ç§»åŠ¨éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testGameSound('merge')">åˆå¹¶éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testGameSound('newTile')">æ–°æ–¹å—éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testGameSound('gameOver')">æ¸¸æˆç»“æŸ</button>
                <button class="test-btn" onclick="testGameSound('victory')">èƒœåˆ©éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testGameSound('error')">é”™è¯¯éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testGameSound('buttonClick')">æŒ‰é’®ç‚¹å‡»</button>
            </div>
            
            <!-- å“ªå’æŠ€èƒ½éŸ³æ•ˆæµ‹è¯• -->
            <div class="test-section">
                <h4>âš¡ å“ªå’æŠ€èƒ½éŸ³æ•ˆ</h4>
                <button class="test-btn" onclick="testSkillSound('skillReady')">æŠ€èƒ½å‡†å¤‡</button>
                <button class="test-btn" onclick="testSkillSound('threeHeads')">ä¸‰å¤´å…­è‡‚</button>
                <button class="test-btn" onclick="testSkillSound('qiankunCircle')">ä¹¾å¤åœˆ</button>
                <button class="test-btn" onclick="testSkillSound('huntianLing')">æ··å¤©ç»«</button>
                <button class="test-btn" onclick="testSkillSound('transformation')">å“ªå’å˜èº«</button>
            </div>
            
            <!-- èƒŒæ™¯éŸ³ä¹æµ‹è¯• -->\n            <div class="test-section">
                <h4>ğŸ¼ èƒŒæ™¯éŸ³ä¹</h4>
                <button class="test-btn" onclick="testMusic('background')">æ¸¸æˆèƒŒæ™¯éŸ³ä¹</button>
                <button class="test-btn" onclick="testMusic('transformation')">å˜èº«èƒŒæ™¯éŸ³ä¹</button>
                <button class="test-btn" onclick="testMusic('victory')">èƒœåˆ©èƒŒæ™¯éŸ³ä¹</button>
                <button class="test-btn" onclick="stopAllMusic()">åœæ­¢æ‰€æœ‰éŸ³ä¹</button>
            </div>
            
            <!-- æ™ºèƒ½éŸ³æ•ˆæµ‹è¯• -->
            <div class="combo-test">
                <h4>ğŸ”¥ è¿å‡»éŸ³æ•ˆæµ‹è¯•</h4>
                <p>æµ‹è¯•æ ¹æ®è¿å‡»æ•°è°ƒæ•´çš„éŸ³æ•ˆ</p>
                <button class="test-btn" onclick="testComboSound(1)">1è¿å‡»</button>
                <button class="test-btn" onclick="testComboSound(3)">3è¿å‡»</button>
                <button class="test-btn" onclick="testComboSound(5)">5è¿å‡»</button>
                <button class="test-btn" onclick="testComboSound(10)">10è¿å‡»</button>
                <button class="test-btn" onclick="testComboSequence()">è¿å‡»åºåˆ—</button>
            </div>
            
            <div class="score-test">
                <h4>ğŸ’° åˆ†æ•°éŸ³æ•ˆæµ‹è¯•</h4>
                <p>æµ‹è¯•æ ¹æ®åˆ†æ•°è°ƒæ•´çš„éŸ³æ•ˆ</p>
                <button class="test-btn" onclick="testScoreSound(100)">100åˆ†</button>
                <button class="test-btn" onclick="testScoreSound(500)">500åˆ†</button>
                <button class="test-btn" onclick="testScoreSound(1000)">1000åˆ†</button>
                <button class="test-btn" onclick="testScoreSound(5000)">5000åˆ†</button>
                <button class="test-btn" onclick="testScoreSequence()">åˆ†æ•°åºåˆ—</button>
            </div>
            
            <div class="tile-test">
                <h4>ğŸ¯ æ–¹å—å‡çº§éŸ³æ•ˆæµ‹è¯•</h4>
                <p>æµ‹è¯•æ ¹æ®æ–¹å—å€¼è°ƒæ•´çš„éŸ³æ•ˆ</p>
                <button class="test-btn" onclick="testTileUpgradeSound(4)">4æ–¹å—</button>
                <button class="test-btn" onclick="testTileUpgradeSound(16)">16æ–¹å—</button>
                <button class="test-btn" onclick="testTileUpgradeSound(64)">64æ–¹å—</button>
                <button class="test-btn" onclick="testTileUpgradeSound(256)">256æ–¹å—</button>
                <button class="test-btn" onclick="testTileUpgradeSound(1024)">1024æ–¹å—</button>
                <button class="test-btn" onclick="testTileUpgradeSound(2048)">2048æ–¹å—</button>
                <button class="test-btn" onclick="testTileUpgradeSequence()">å‡çº§åºåˆ—</button>
            </div>
            
            <div class="sequence-test">
                <h4>ğŸ­ éŸ³æ•ˆåºåˆ—æµ‹è¯•</h4>
                <p>æµ‹è¯•å¤æ‚çš„éŸ³æ•ˆç»„åˆå’Œåºåˆ—</p>
                <button class="test-btn" onclick="testGameplaySequence()">æ¸¸æˆæµç¨‹åºåˆ—</button>
                <button class="test-btn" onclick="testSkillSequence()">æŠ€èƒ½æ¿€æ´»åºåˆ—</button>
                <button class="test-btn" onclick="testTransformationSequence()">å˜èº«å®Œæ•´åºåˆ—</button>
                <button class="test-btn" onclick="testVictorySequence()">èƒœåˆ©åº†ç¥åºåˆ—</button>
            </div>
            
            <!-- éŸ³é‡æ§åˆ¶ -->
            <div class="test-section">
                <h4>ğŸ”Š éŸ³é‡æ§åˆ¶</h4>
                <div class="volume-control">
                    <label>ä¸»éŸ³é‡:</label>
                    <input type="range" id="master-volume" min="0" max="100" value="70">
                    <span class="volume-value" id="master-volume-value">70%</span>
                </div>
                <div class="volume-control">
                    <label>éŸ³æ•ˆéŸ³é‡:</label>
                    <input type="range" id="sound-volume" min="0" max="100" value="80">
                    <span class="volume-value" id="sound-volume-value">80%</span>
                </div>
                <div class="volume-control">
                    <label>éŸ³ä¹éŸ³é‡:</label>
                    <input type="range" id="music-volume" min="0" max="100" value="60">
                    <span class="volume-value" id="music-volume-value">60%</span>
                </div>
                <div style="margin-top: 10px;">
                    <button class="test-btn" onclick="toggleMute()">åˆ‡æ¢é™éŸ³</button>
                    <button class="test-btn" onclick="applyVolumeSettings()">åº”ç”¨éŸ³é‡è®¾ç½®</button>
                </div>
            </div>
            
            <!-- éŸ³é¢‘çŠ¶æ€æ˜¾ç¤º -->
            <div class="audio-status" id="audio-status" style="display: none;">
                <h4>ğŸ“Š éŸ³é¢‘ç³»ç»ŸçŠ¶æ€ï¼š</h4>
                <div id="audio-status-content"></div>
            </div>
            
            <div id="test-results" style="margin-top: 10px; font-size: 0.9rem; text-align: left; max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="js/managers/AudioManager.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let audioManager = null;
        
        // æµ‹è¯•å‡½æ•°
        function logTest(message, type = 'info') {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : type === 'warning' ? 'orange' : 'black';
            results.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }

        function clearTestResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        function initializeAudioSystem() {
            try {
                if (audioManager) {
                    logTest('éŸ³é¢‘ç®¡ç†å™¨å·²å­˜åœ¨ï¼Œå…ˆé”€æ¯æ—§å®ä¾‹', 'warning');
                    audioManager.destroy();
                }
                
                audioManager = new AudioManager();
                
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                audioManager.on('initialized', () => {
                    logTest('âœ… éŸ³é¢‘ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ', 'success');
                });
                
                audioManager.on('nezhaAudioLoaded', () => {
                    logTest('âœ… å“ªå’ä¸»é¢˜éŸ³é¢‘èµ„æºåŠ è½½å®Œæˆ', 'success');
                });
                
                audioManager.on('audioLoaded', (data) => {
                    logTest(`âœ… éŸ³é¢‘åŠ è½½å®Œæˆ: ${data.name} (${data.type})`, 'success');
                });
                
                audioManager.on('error', (data) => {
                    logTest(`âŒ éŸ³é¢‘ç®¡ç†å™¨é”™è¯¯: ${data.error}`, 'error');
                });
                
                audioManager.on('volumeChanged', (data) => {
                    logTest(`ğŸ”Š éŸ³é‡å˜åŒ–: ${data.type} = ${Math.round(data.volume * 100)}%`);
                    updateVolumeDisplay();
                });
                
                audioManager.on('muteChanged', (data) => {
                    logTest(`ğŸ”‡ é™éŸ³çŠ¶æ€: ${data.muted ? 'å¼€å¯' : 'å…³é—­'}`);
                });
                
                logTest('ğŸµ æ­£åœ¨åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨...');
                
            } catch (error) {
                logTest(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function destroyAudioSystem() {
            if (audioManager) {
                audioManager.destroy();
                audioManager = null;
                logTest('ğŸ—‘ï¸ éŸ³é¢‘ç®¡ç†å™¨å·²é”€æ¯', 'success');
            } else {
                logTest('âš ï¸ éŸ³é¢‘ç®¡ç†å™¨ä¸å­˜åœ¨', 'warning');
            }
        }

        function testGameSound(soundName) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                switch (soundName) {
                    case 'move':
                        audioManager.playMoveSound();
                        break;
                    case 'merge':
                        audioManager.playMergeSound();
                        break;
                    case 'newTile':
                        audioManager.playNewTileSound();
                        break;
                    case 'gameOver':
                        audioManager.playGameOverSound();
                        break;
                    case 'victory':
                        audioManager.playVictorySound();
                        break;
                    case 'error':
                        audioManager.playErrorSound();
                        break;
                    case 'buttonClick':
                        audioManager.playButtonClickSound();
                        break;
                    default:
                        audioManager.playSound(soundName);
                }
                
                logTest(`ğŸµ æ’­æ”¾æ¸¸æˆéŸ³æ•ˆ: ${soundName}`);
                
            } catch (error) {
                logTest(`âŒ æ’­æ”¾æ¸¸æˆéŸ³æ•ˆå¤±è´¥ ${soundName}: ${error.message}`, 'error');
            }
        }

        function testSkillSound(soundName) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                switch (soundName) {
                    case 'skillReady':
                        audioManager.playSkillReadySound();
                        break;
                    case 'threeHeads':
                        audioManager.playThreeHeadsSound();
                        break;
                    case 'qiankunCircle':
                        audioManager.playQiankunCircleSound();
                        break;
                    case 'huntianLing':
                        audioManager.playHuntianLingSound();
                        break;
                    case 'transformation':
                        audioManager.playTransformationSound();
                        break;
                    default:
                        audioManager.playSound(soundName);
                }
                
                logTest(`âš¡ æ’­æ”¾æŠ€èƒ½éŸ³æ•ˆ: ${soundName}`);
                
            } catch (error) {
                logTest(`âŒ æ’­æ”¾æŠ€èƒ½éŸ³æ•ˆå¤±è´¥ ${soundName}: ${error.message}`, 'error');
            }
        }

        function testMusic(musicName) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                switch (musicName) {
                    case 'background':
                        audioManager.playBackgroundMusic();
                        break;
                    case 'transformation':
                        audioManager.playTransformationMusic();
                        break;
                    case 'victory':
                        audioManager.playVictoryMusic();
                        break;
                    default:
                        audioManager.playMusic(musicName);
                }
                
                logTest(`ğŸ¼ æ’­æ”¾èƒŒæ™¯éŸ³ä¹: ${musicName}`);
                
            } catch (error) {
                logTest(`âŒ æ’­æ”¾èƒŒæ™¯éŸ³ä¹å¤±è´¥ ${musicName}: ${error.message}`, 'error');
            }
        }

        function stopAllMusic() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                audioManager.stopMusic();
                logTest('â¹ï¸ æ‰€æœ‰èƒŒæ™¯éŸ³ä¹å·²åœæ­¢');
            } catch (error) {
                logTest(`âŒ åœæ­¢èƒŒæ™¯éŸ³ä¹å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testComboSound(comboCount) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                if (audioManager.playComboSound) {
                    audioManager.playComboSound(comboCount);
                    logTest(`ğŸ”¥ æ’­æ”¾${comboCount}è¿å‡»éŸ³æ•ˆ`);
                } else {
                    logTest('âš ï¸ è¿å‡»éŸ³æ•ˆæ–¹æ³•ä¸å­˜åœ¨', 'warning');
                }
            } catch (error) {
                logTest(`âŒ æ’­æ”¾è¿å‡»éŸ³æ•ˆå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testScoreSound(score) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                if (audioManager.playScoreSound) {
                    audioManager.playScoreSound(score);
                    logTest(`ğŸ’° æ’­æ”¾${score}åˆ†éŸ³æ•ˆ`);
                } else {
                    logTest('âš ï¸ åˆ†æ•°éŸ³æ•ˆæ–¹æ³•ä¸å­˜åœ¨', 'warning');
                }
            } catch (error) {
                logTest(`âŒ æ’­æ”¾åˆ†æ•°éŸ³æ•ˆå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testTileUpgradeSound(tileValue) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                if (audioManager.playTileUpgradeSound) {
                    audioManager.playTileUpgradeSound(tileValue);
                    logTest(`ğŸ¯ æ’­æ”¾${tileValue}æ–¹å—å‡çº§éŸ³æ•ˆ`);
                } else {
                    logTest('âš ï¸ æ–¹å—å‡çº§éŸ³æ•ˆæ–¹æ³•ä¸å­˜åœ¨', 'warning');
                }
            } catch (error) {
                logTest(`âŒ æ’­æ”¾æ–¹å—å‡çº§éŸ³æ•ˆå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testComboSequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('ğŸ”¥ å¼€å§‹è¿å‡»åºåˆ—æµ‹è¯•...');
            
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    testComboSound(i);
                }, i * 300);
            }
        }

        function testScoreSequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('ğŸ’° å¼€å§‹åˆ†æ•°åºåˆ—æµ‹è¯•...');
            
            const scores = [100, 300, 500, 1000, 2000];
            scores.forEach((score, index) => {
                setTimeout(() => {
                    testScoreSound(score);
                }, index * 400);
            });
        }

        function testTileUpgradeSequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('ğŸ¯ å¼€å§‹æ–¹å—å‡çº§åºåˆ—æµ‹è¯•...');
            
            const tiles = [4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048];
            tiles.forEach((tile, index) => {
                setTimeout(() => {
                    testTileUpgradeSound(tile);
                }, index * 300);
            });
        }

        function testGameplaySequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('ğŸ® å¼€å§‹æ¸¸æˆæµç¨‹åºåˆ—æµ‹è¯•...');
            
            const sequence = [
                { action: () => testGameSound('move'), delay: 0, name: 'ç§»åŠ¨' },
                { action: () => testGameSound('newTile'), delay: 200, name: 'æ–°æ–¹å—' },
                { action: () => testGameSound('move'), delay: 500, name: 'ç§»åŠ¨' },
                { action: () => testGameSound('merge'), delay: 200, name: 'åˆå¹¶' },
                { action: () => testComboSound(2), delay: 300, name: '2è¿å‡»' },
                { action: () => testScoreSound(500), delay: 200, name: 'å¾—åˆ†' }
            ];
            
            let totalDelay = 0;
            sequence.forEach(step => {
                totalDelay += step.delay;
                setTimeout(() => {
                    step.action();
                    logTest(`  â†’ ${step.name}`);
                }, totalDelay);
            });
        }

        function testSkillSequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('âš¡ å¼€å§‹æŠ€èƒ½æ¿€æ´»åºåˆ—æµ‹è¯•...');
            
            const skills = ['skillReady', 'threeHeads', 'qiankunCircle', 'huntianLing'];
            skills.forEach((skill, index) => {
                setTimeout(() => {
                    testSkillSound(skill);
                }, index * 800);
            });
        }

        function testTransformationSequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('âš¡ å¼€å§‹å˜èº«å®Œæ•´åºåˆ—æµ‹è¯•...');
            
            // æŠ€èƒ½å‡†å¤‡
            setTimeout(() => {
                testSkillSound('skillReady');
                logTest('  â†’ å˜èº«æŠ€èƒ½å‡†å¤‡å°±ç»ª');
            }, 0);
            
            // å˜èº«æ¿€æ´»
            setTimeout(() => {
                testSkillSound('transformation');
                logTest('  â†’ å“ªå’å˜èº«æ¿€æ´»');
            }, 1000);
            
            // å˜èº«éŸ³ä¹
            setTimeout(() => {
                testMusic('transformation');
                logTest('  â†’ å˜èº«èƒŒæ™¯éŸ³ä¹å¼€å§‹');
            }, 2000);
            
            // å˜èº«æœŸé—´çš„å¼ºåŒ–æ•ˆæœ
            setTimeout(() => {
                testComboSound(5);
                logTest('  â†’ å˜èº«æœŸé—´è¿å‡»æ•ˆæœ');
            }, 4000);
            
            setTimeout(() => {
                testScoreSound(2000);
                logTest('  â†’ å˜èº«æœŸé—´é«˜åˆ†æ•ˆæœ');
            }, 5000);
            
            // å˜èº«ç»“æŸï¼Œæ¢å¤èƒŒæ™¯éŸ³ä¹
            setTimeout(() => {
                testMusic('background');
                logTest('  â†’ å˜èº«ç»“æŸï¼Œæ¢å¤èƒŒæ™¯éŸ³ä¹');
            }, 8000);
        }

        function testVictorySequence() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            logTest('ğŸ‰ å¼€å§‹èƒœåˆ©åº†ç¥åºåˆ—æµ‹è¯•...');
            
            // è¾¾æˆ2048
            setTimeout(() => {
                testTileUpgradeSound(2048);
                logTest('  â†’ è¾¾æˆ2048æ–¹å—');
            }, 0);
            
            // èƒœåˆ©éŸ³æ•ˆ
            setTimeout(() => {
                testGameSound('victory');
                logTest('  â†’ èƒœåˆ©éŸ³æ•ˆ');
            }, 500);
            
            // æ–°çºªå½•éŸ³æ•ˆ
            setTimeout(() => {
                if (audioManager.playNewRecordSound) {
                    audioManager.playNewRecordSound();
                    logTest('  â†’ æ–°çºªå½•éŸ³æ•ˆ');
                } else {
                    testGameSound('victory');
                    logTest('  â†’ å¤‡ç”¨èƒœåˆ©éŸ³æ•ˆ');
                }
            }, 1000);
            
            // èƒœåˆ©èƒŒæ™¯éŸ³ä¹
            setTimeout(() => {
                testMusic('victory');
                logTest('  â†’ èƒœåˆ©èƒŒæ™¯éŸ³ä¹');
            }, 1500);
        }

        function toggleMute() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                audioManager.toggleMute();
                logTest('ğŸ”‡ åˆ‡æ¢é™éŸ³çŠ¶æ€');
            } catch (error) {
                logTest(`âŒ åˆ‡æ¢é™éŸ³å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function applyVolumeSettings() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const masterVolume = document.getElementById('master-volume').value / 100;
                const soundVolume = document.getElementById('sound-volume').value / 100;
                const musicVolume = document.getElementById('music-volume').value / 100;
                
                audioManager.setMasterVolume(masterVolume);
                audioManager.setSoundVolume(soundVolume);
                audioManager.setMusicVolume(musicVolume);
                
                logTest(`ğŸ”Š éŸ³é‡è®¾ç½®æ›´æ–°: ä¸»éŸ³é‡=${Math.round(masterVolume*100)}%, éŸ³æ•ˆ=${Math.round(soundVolume*100)}%, éŸ³ä¹=${Math.round(musicVolume*100)}%`);
                
            } catch (error) {
                logTest(`âŒ éŸ³é‡è®¾ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showAudioStatus() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const info = audioManager.getAudioInfo();
                const statusDiv = document.getElementById('audio-status');
                const contentDiv = document.getElementById('audio-status-content');
                
                contentDiv.innerHTML = `
                    <div style="margin: 5px 0;">
                        <span class="status-indicator ${info.webAudioSupported ? 'active' : 'inactive'}"></span>
                        Web Audio API: ${info.webAudioSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
                    </div>
                    <div style="margin: 5px 0;">
                        <span class="status-indicator ${info.htmlAudioSupported ? 'active' : 'inactive'}"></span>
                        HTML Audio: ${info.htmlAudioSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
                    </div>
                    <div style="margin: 5px 0;">
                        <span class="status-indicator ${info.userInteracted ? 'active' : 'inactive'}"></span>
                        ç”¨æˆ·äº¤äº’: ${info.userInteracted ? 'å·²äº¤äº’' : 'æœªäº¤äº’'}
                    </div>
                    <div style="margin: 5px 0;">
                        <span class="status-indicator ${info.audioContextState === 'running' ? 'active' : 'inactive'}"></span>
                        éŸ³é¢‘ä¸Šä¸‹æ–‡: ${info.audioContextState || 'æœªåˆ›å»º'}
                    </div>
                    <div style="margin: 5px 0;">
                        <strong>å·²åŠ è½½éŸ³æ•ˆ:</strong> ${info.loadedSounds.length} ä¸ª (${info.loadedSounds.join(', ') || 'æ— '})
                    </div>
                    <div style="margin: 5px 0;">
                        <strong>å·²åŠ è½½éŸ³ä¹:</strong> ${info.loadedMusic.length} ä¸ª (${info.loadedMusic.join(', ') || 'æ— '})
                    </div>
                    <div style="margin: 5px 0;">
                        <strong>å½“å‰éŸ³ä¹:</strong> ${info.currentMusic || 'æ— '}
                    </div>
                    <div style="margin: 5px 0;">
                        <strong>éŸ³é‡è®¾ç½®:</strong> ä¸»éŸ³é‡=${Math.round(info.volumes.master*100)}%, éŸ³æ•ˆ=${Math.round(info.volumes.sound*100)}%, éŸ³ä¹=${Math.round(info.volumes.music*100)}%
                    </div>
                    <div style="margin: 5px 0;">
                        <span class="status-indicator ${info.isMuted ? 'inactive' : 'active'}"></span>
                        é™éŸ³çŠ¶æ€: ${info.isMuted ? 'å·²é™éŸ³' : 'æ­£å¸¸'}
                    </div>
                `;
                
                statusDiv.style.display = 'block';
                logTest('ğŸ“Š éŸ³é¢‘ç³»ç»ŸçŠ¶æ€å·²æ˜¾ç¤º');
                
            } catch (error) {
                logTest(`âŒ è·å–éŸ³é¢‘çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function updateVolumeDisplay() {
            if (!audioManager) return;
            
            const info = audioManager.getAudioInfo();
            document.getElementById('master-volume-value').textContent = Math.round(info.volumes.master * 100) + '%';
            document.getElementById('sound-volume-value').textContent = Math.round(info.volumes.sound * 100) + '%';
            document.getElementById('music-volume-value').textContent = Math.round(info.volumes.music * 100) + '%';
        }

        // ç»‘å®šéŸ³é‡æ»‘å—äº‹ä»¶
        document.getElementById('master-volume').addEventListener('input', (e) => {
            document.getElementById('master-volume-value').textContent = e.target.value + '%';
        });

        document.getElementById('sound-volume').addEventListener('input', (e) => {
            document.getElementById('sound-volume-value').textContent = e.target.value + '%';
        });

        document.getElementById('music-volume').addEventListener('input', (e) => {
            document.getElementById('music-volume-value').textContent = e.target.value + '%';
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            logTest('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•å“ªå’ä¸»é¢˜éŸ³æ•ˆ');
            logTest('ğŸ’¡ æç¤º: ç‚¹å‡»"åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ"å¼€å§‹æµ‹è¯•');
            logTest('ğŸµ æœ¬æµ‹è¯•åŒ…å«åŸºç¡€éŸ³æ•ˆã€æŠ€èƒ½éŸ³æ•ˆã€æ™ºèƒ½éŸ³æ•ˆå’ŒéŸ³æ•ˆåºåˆ—');
        });
    </script>
</body>
</html>