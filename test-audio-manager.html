<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘ç®¡ç†å™¨æµ‹è¯• - å“ªå’2048</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .test-controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            text-align: center;
        }
        
        .test-btn {
            margin: 5px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
        
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .test-info {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 0, 0.1);
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .instruction-box {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .instruction-box h4 {
            margin: 0 0 10px 0;
            color: #DC143C;
        }
        
        .audio-controls {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .volume-control {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-control label {
            min-width: 80px;
            font-weight: 600;
        }
        
        .volume-control input[type="range"] {
            flex: 1;
            max-width: 200px;
        }
        
        .volume-value {
            min-width: 40px;
            font-weight: 600;
            color: #007bff;
        }
        
        .audio-info {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 255, 0.3);
            text-align: left;
        }
        
        .audio-info h4 {
            margin: 0 0 10px 0;
            color: #0056b3;
        }
        
        .info-item {
            margin: 5px 0;
            padding: 5px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 3px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.active {
            background: #28a745;
        }
        
        .status-indicator.inactive {
            background: #dc3545;
        }
        
        .status-indicator.warning {
            background: #ffc107;
        }
    </style>
</head>
<body data-theme="nezha">
    <div id="game-container">
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-controls">
            <h3>éŸ³é¢‘ç®¡ç†å™¨æµ‹è¯•</h3>
            <div class="test-info">
                <p>æµ‹è¯•Web Audio APIå’ŒHTML Audioçš„éŸ³é¢‘æ’­æ”¾åŠŸèƒ½</p>
                <p><strong>æ³¨æ„ï¼š</strong> éœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾éŸ³é¢‘</p>
            </div>
            
            <div class="instruction-box">
                <h4>ğŸµ éŸ³é¢‘ç®¡ç†å™¨åŠŸèƒ½æµ‹è¯•ï¼š</h4>
                <p>1. ç‚¹å‡»"åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨"å¼€å§‹æµ‹è¯•</p>
                <p>2. æµ‹è¯•å„ç§éŸ³æ•ˆå’ŒèƒŒæ™¯éŸ³ä¹</p>
                <p>3. è°ƒæ•´éŸ³é‡æ§åˆ¶</p>
                <p>4. æµ‹è¯•é™éŸ³åŠŸèƒ½</p>
                <p>5. æŸ¥çœ‹éŸ³é¢‘ç³»ç»Ÿä¿¡æ¯</p>
            </div>
            
            <!-- åˆå§‹åŒ–æ§åˆ¶ -->
            <div style="margin: 15px 0;">
                <button class="test-btn" onclick="initializeAudioManager()">åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨</button>
                <button class="test-btn" onclick="destroyAudioManager()">é”€æ¯éŸ³é¢‘ç®¡ç†å™¨</button>
                <button class="test-btn" onclick="showAudioInfo()">æ˜¾ç¤ºéŸ³é¢‘ä¿¡æ¯</button>
            </div>
            
            <!-- éŸ³æ•ˆæµ‹è¯• -->
            <div style="margin: 15px 0;">
                <h4>ğŸµ éŸ³æ•ˆæµ‹è¯•ï¼š</h4>
                <button class="test-btn" onclick="testSound('move')">ç§»åŠ¨éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testSound('merge')">åˆå¹¶éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testSound('newTile')">æ–°æ–¹å—éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testSound('skillReady')">æŠ€èƒ½å‡†å¤‡éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testSound('buttonClick')">æŒ‰é’®ç‚¹å‡»éŸ³æ•ˆ</button>
                <button class="test-btn" onclick="testSound('error')">é”™è¯¯éŸ³æ•ˆ</button>
            </div>
            
            <!-- æŠ€èƒ½éŸ³æ•ˆæµ‹è¯• -->
            <div style="margin: 15px 0;">
                <h4>âš¡ æŠ€èƒ½éŸ³æ•ˆæµ‹è¯•ï¼š</h4>
                <button class="test-btn" onclick="testSound('threeHeads')">ä¸‰å¤´å…­è‡‚</button>
                <button class="test-btn" onclick="testSound('qiankunCircle')">ä¹¾å¤åœˆ</button>
                <button class="test-btn" onclick="testSound('huntianLing')">æ··å¤©ç»«</button>
                <button class="test-btn" onclick="testSound('transformation')">å“ªå’å˜èº«</button>
                <button class="test-btn" onclick="testSound('gameOver')">æ¸¸æˆç»“æŸ</button>
                <button class="test-btn" onclick="testSound('victory')">èƒœåˆ©éŸ³æ•ˆ</button>
            </div>
            
            <!-- èƒŒæ™¯éŸ³ä¹æµ‹è¯• -->
            <div style="margin: 15px 0;">
                <h4>ğŸ¼ èƒŒæ™¯éŸ³ä¹æµ‹è¯•ï¼š</h4>
                <button class="test-btn" onclick="testMusic('background')">èƒŒæ™¯éŸ³ä¹</button>
                <button class="test-btn" onclick="testMusic('transformation')">å˜èº«éŸ³ä¹</button>
                <button class="test-btn" onclick="testMusic('victory')">èƒœåˆ©éŸ³ä¹</button>
                <button class="test-btn" onclick="stopMusic()">åœæ­¢éŸ³ä¹</button>
            </div>
            
            <!-- éŸ³é‡æ§åˆ¶ -->
            <div class="audio-controls">
                <h4>ğŸ”Š éŸ³é‡æ§åˆ¶ï¼š</h4>
                <div class="volume-control">
                    <label>ä¸»éŸ³é‡:</label>
                    <input type="range" id="master-volume" min="0" max="100" value="70">
                    <span class="volume-value" id="master-volume-value">70%</span>
                </div>
                <div class="volume-control">
                    <label>éŸ³æ•ˆéŸ³é‡:</label>
                    <input type="range" id="sound-volume" min="0" max="100" value="80">
                    <span class="volume-value" id="sound-volume-value">80%</span>
                </div>
                <div class="volume-control">
                    <label>éŸ³ä¹éŸ³é‡:</label>
                    <input type="range" id="music-volume" min="0" max="100" value="60">
                    <span class="volume-value" id="music-volume-value">60%</span>
                </div>
                <div style="margin-top: 10px;">
                    <button class="test-btn" onclick="toggleMute()">åˆ‡æ¢é™éŸ³</button>
                    <button class="test-btn" onclick="testVolumeSettings()">æµ‹è¯•éŸ³é‡è®¾ç½®</button>
                </div>
            </div>
            
            <!-- éŸ³é¢‘ä¿¡æ¯æ˜¾ç¤º -->
            <div class="audio-info" id="audio-info" style="display: none;">
                <h4>ğŸ“Š éŸ³é¢‘ç³»ç»Ÿä¿¡æ¯ï¼š</h4>
                <div id="audio-info-content"></div>
            </div>
            
            <div id="test-results" style="margin-top: 10px; font-size: 0.9rem; text-align: left;"></div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="js/managers/AudioManager.js"></script>

    <script>
        // å…¨å±€å˜é‡
        let audioManager = null;
        
        // æµ‹è¯•å‡½æ•°
        function logTest(message, type = 'info') {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            results.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }

        function clearTestResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        function initializeAudioManager() {
            try {
                if (audioManager) {
                    logTest('éŸ³é¢‘ç®¡ç†å™¨å·²å­˜åœ¨ï¼Œå…ˆé”€æ¯æ—§å®ä¾‹', 'warning');
                    audioManager.destroy();
                }
                
                audioManager = new AudioManager();
                
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                audioManager.on('initialized', () => {
                    logTest('âœ… éŸ³é¢‘ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ', 'success');
                });
                
                audioManager.on('nezhaAudioLoaded', () => {
                    logTest('âœ… å“ªå’ä¸»é¢˜éŸ³é¢‘èµ„æºåŠ è½½å®Œæˆ', 'success');
                });
                
                audioManager.on('audioLoaded', (data) => {
                    logTest(`âœ… éŸ³é¢‘åŠ è½½å®Œæˆ: ${data.name} (${data.type})`, 'success');
                });
                
                audioManager.on('error', (data) => {
                    logTest(`âŒ éŸ³é¢‘ç®¡ç†å™¨é”™è¯¯: ${data.error}`, 'error');
                });
                
                audioManager.on('volumeChanged', (data) => {
                    logTest(`ğŸ”Š éŸ³é‡å˜åŒ–: ${data.type} = ${Math.round(data.volume * 100)}%`);
                    updateVolumeDisplay();
                });
                
                audioManager.on('muteChanged', (data) => {
                    logTest(`ğŸ”‡ é™éŸ³çŠ¶æ€: ${data.muted ? 'å¼€å¯' : 'å…³é—­'}`);
                });
                
                logTest('ğŸµ æ­£åœ¨åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨...');
                
            } catch (error) {
                logTest(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function destroyAudioManager() {
            if (audioManager) {
                audioManager.destroy();
                audioManager = null;
                logTest('ğŸ—‘ï¸ éŸ³é¢‘ç®¡ç†å™¨å·²é”€æ¯', 'success');
            } else {
                logTest('âš ï¸ éŸ³é¢‘ç®¡ç†å™¨ä¸å­˜åœ¨', 'warning');
            }
        }

        function testSound(soundName) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                // ä½¿ç”¨ä¾¿æ·æ–¹æ³•æ’­æ”¾éŸ³æ•ˆ
                switch (soundName) {
                    case 'move':
                        audioManager.playMoveSound();
                        break;
                    case 'merge':
                        audioManager.playMergeSound();
                        break;
                    case 'newTile':
                        audioManager.playNewTileSound();
                        break;
                    case 'skillReady':
                        audioManager.playSkillReadySound();
                        break;
                    case 'threeHeads':
                        audioManager.playThreeHeadsSound();
                        break;
                    case 'qiankunCircle':
                        audioManager.playQiankunCircleSound();
                        break;
                    case 'huntianLing':
                        audioManager.playHuntianLingSound();
                        break;
                    case 'transformation':
                        audioManager.playTransformationSound();
                        break;
                    case 'gameOver':
                        audioManager.playGameOverSound();
                        break;
                    case 'victory':
                        audioManager.playVictorySound();
                        break;
                    case 'buttonClick':
                        audioManager.playButtonClickSound();
                        break;
                    case 'error':
                        audioManager.playErrorSound();
                        break;
                    default:
                        audioManager.playSound(soundName);
                }
                
                logTest(`ğŸµ æ’­æ”¾éŸ³æ•ˆ: ${soundName}`);
                
            } catch (error) {
                logTest(`âŒ æ’­æ”¾éŸ³æ•ˆå¤±è´¥ ${soundName}: ${error.message}`, 'error');
            }
        }

        function testMusic(musicName) {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                // ä½¿ç”¨ä¾¿æ·æ–¹æ³•æ’­æ”¾éŸ³ä¹
                switch (musicName) {
                    case 'background':
                        audioManager.playBackgroundMusic();
                        break;
                    case 'transformation':
                        audioManager.playTransformationMusic();
                        break;
                    case 'victory':
                        audioManager.playVictoryMusic();
                        break;
                    default:
                        audioManager.playMusic(musicName);
                }
                
                logTest(`ğŸ¼ æ’­æ”¾èƒŒæ™¯éŸ³ä¹: ${musicName}`);
                
            } catch (error) {
                logTest(`âŒ æ’­æ”¾èƒŒæ™¯éŸ³ä¹å¤±è´¥ ${musicName}: ${error.message}`, 'error');
            }
        }

        function stopMusic() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                audioManager.stopMusic();
                logTest('â¹ï¸ èƒŒæ™¯éŸ³ä¹å·²åœæ­¢');
            } catch (error) {
                logTest(`âŒ åœæ­¢èƒŒæ™¯éŸ³ä¹å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function toggleMute() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                audioManager.toggleMute();
                logTest('ğŸ”‡ åˆ‡æ¢é™éŸ³çŠ¶æ€');
            } catch (error) {
                logTest(`âŒ åˆ‡æ¢é™éŸ³å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testVolumeSettings() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const masterVolume = document.getElementById('master-volume').value / 100;
                const soundVolume = document.getElementById('sound-volume').value / 100;
                const musicVolume = document.getElementById('music-volume').value / 100;
                
                audioManager.setMasterVolume(masterVolume);
                audioManager.setSoundVolume(soundVolume);
                audioManager.setMusicVolume(musicVolume);
                
                logTest(`ğŸ”Š éŸ³é‡è®¾ç½®æ›´æ–°: ä¸»éŸ³é‡=${Math.round(masterVolume*100)}%, éŸ³æ•ˆ=${Math.round(soundVolume*100)}%, éŸ³ä¹=${Math.round(musicVolume*100)}%`);
                
            } catch (error) {
                logTest(`âŒ éŸ³é‡è®¾ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showAudioInfo() {
            if (!audioManager) {
                logTest('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            try {
                const info = audioManager.getAudioInfo();
                const infoDiv = document.getElementById('audio-info');
                const contentDiv = document.getElementById('audio-info-content');
                
                contentDiv.innerHTML = `
                    <div class="info-item">
                        <span class="status-indicator ${info.webAudioSupported ? 'active' : 'inactive'}"></span>
                        Web Audio API: ${info.webAudioSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
                    </div>
                    <div class="info-item">
                        <span class="status-indicator ${info.htmlAudioSupported ? 'active' : 'inactive'}"></span>
                        HTML Audio: ${info.htmlAudioSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}
                    </div>
                    <div class="info-item">
                        <span class="status-indicator ${info.userInteracted ? 'active' : 'warning'}"></span>
                        ç”¨æˆ·äº¤äº’: ${info.userInteracted ? 'å·²äº¤äº’' : 'æœªäº¤äº’'}
                    </div>
                    <div class="info-item">
                        <span class="status-indicator ${info.audioContextState === 'running' ? 'active' : 'warning'}"></span>
                        éŸ³é¢‘ä¸Šä¸‹æ–‡: ${info.audioContextState || 'æœªåˆ›å»º'}
                    </div>
                    <div class="info-item">
                        <strong>å·²åŠ è½½éŸ³æ•ˆ:</strong> ${info.loadedSounds.join(', ') || 'æ— '}
                    </div>
                    <div class="info-item">
                        <strong>å·²åŠ è½½éŸ³ä¹:</strong> ${info.loadedMusic.join(', ') || 'æ— '}
                    </div>
                    <div class="info-item">
                        <strong>å½“å‰éŸ³ä¹:</strong> ${info.currentMusic || 'æ— '}
                    </div>
                    <div class="info-item">
                        <strong>éŸ³é‡è®¾ç½®:</strong> ä¸»éŸ³é‡=${Math.round(info.volumes.master*100)}%, éŸ³æ•ˆ=${Math.round(info.volumes.sound*100)}%, éŸ³ä¹=${Math.round(info.volumes.music*100)}%
                    </div>
                    <div class="info-item">
                        <span class="status-indicator ${info.isMuted ? 'inactive' : 'active'}"></span>
                        é™éŸ³çŠ¶æ€: ${info.isMuted ? 'å·²é™éŸ³' : 'æ­£å¸¸'}
                    </div>
                `;
                
                infoDiv.style.display = 'block';
                logTest('ğŸ“Š éŸ³é¢‘ç³»ç»Ÿä¿¡æ¯å·²æ˜¾ç¤º');
                
            } catch (error) {
                logTest(`âŒ è·å–éŸ³é¢‘ä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function updateVolumeDisplay() {
            if (!audioManager) return;
            
            const info = audioManager.getAudioInfo();
            document.getElementById('master-volume-value').textContent = Math.round(info.volumes.master * 100) + '%';
            document.getElementById('sound-volume-value').textContent = Math.round(info.volumes.sound * 100) + '%';
            document.getElementById('music-volume-value').textContent = Math.round(info.volumes.music * 100) + '%';
        }

        // ç»‘å®šéŸ³é‡æ»‘å—äº‹ä»¶
        document.getElementById('master-volume').addEventListener('input', (e) => {
            document.getElementById('master-volume-value').textContent = e.target.value + '%';
        });

        document.getElementById('sound-volume').addEventListener('input', (e) => {
            document.getElementById('sound-volume-value').textContent = e.target.value + '%';
        });

        document.getElementById('music-volume').addEventListener('input', (e) => {
            document.getElementById('music-volume-value').textContent = e.target.value + '%';
        });

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            logTest('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡æµ‹è¯•éŸ³é¢‘ç®¡ç†å™¨');
            logTest('ğŸ’¡ æç¤º: ç‚¹å‡»"åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨"å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>